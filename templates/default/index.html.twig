{% extends 'base.html.twig' %}

{% block title %}Application météo{% endblock %}

{% block body %}

  <form class="weatherForm">
        <input type="text" placeholder="Entrer la ville" class="cityInput">
        <button type="submit">Obtenir la météo</button>
    </form>

    <div class="card" style="display: none;">
      
    </div>

<script>
     const weatherForm = document.querySelector(".weatherForm")
const cityInput =document.querySelector(".cityInput")
const card = document.querySelector(".card")
const apiKey = "f9a193941392ff5f95501cc6eb4aa952";

weatherForm.addEventListener("submit",async event =>{
    event.preventDefault();

    const city = cityInput.value;

    if(city){
       try{
          const weatherData = await getWeatherData(city);
          displayWeatherInfo(weatherData);
       }
        catch(error){
          console.error(error);
          displayError(error);
        }
      
      }
    

    else {
      displayError("Veuillez entrer une ville !")
    }
})

async function getWeatherData(city) {
  const apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}`;
  
  const response =  await fetch(apiUrl)
  console.log(response)

  if (!response.ok){
    throw new error("Impossible de récupérer les données météo")
  }
   
    return await response.json();
}

function displayWeatherInfo(data){
    const { name : city,
            main :{temp,humidity},
            weather :[{description,id}]} = data;
            
    card.textContent="";
    card.style.display="flex"; 

    const cityDisplay = document.createElement("h1");
    const tempDisplay = document.createElement("p");
    const humidityDisplay = document.createElement("p");
    const descDisplay = document.createElement("p");

    cityDisplay.textContent = city;
    tempDisplay.textContent = `${(temp - 273.15).toFixed(1)}°C`;
    humidityDisplay.textContent =`Humidité : ${humidity}%`;      
    descDisplay.textContent = description;

    cityDisplay.classList.add("cityDisplay");
    tempDisplay.classList.add("tempDisplay")
    humidityDisplay.classList.add("humidityDisplay")
    descDisplay.classList.add("descDisplay");

    card.appendChild(cityDisplay);
    card.appendChild(tempDisplay)
    card.appendChild(humidityDisplay)
    card.appendChild(descDisplay);
}

function displayError(message){
    const errorDisplay = document.createElement("p");
    errorDisplay.textContent = message;
    errorDisplay.classList.add("errorDisplay");

    card.textContent="";
    card.style.display="flex";
    card.appendChild(errorDisplay)
}
</script>

{% endblock %}
